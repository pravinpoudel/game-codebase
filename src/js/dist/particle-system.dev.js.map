{"version":3,"sources":["particle-system.js"],"names":["Brickout","pages","graphics","canvas","document","getElementById","context","getContext","CanvasRenderingContext2D","prototype","clear","save","setTransform","clearRect","width","height","restore","drawRectangle","spec","fillStyle","fill","fillRect","x","y","strokeStyle","stroke","strokeRect","measureTextWidth","font","hasOwnProperty","measureText","text","measureTextHeight","saveText","drawText","textBaseline","fillText","position","strokeText","drawImage","translate","center","rotate","rotation","image","size","ParticleSystem","that","Image","particles","nextName","createEffect","deltaX","right","left","deltaY","bottom","top","posX","posY","speed","mean","stdev","lifetime","count","Math","trunc","makeParticle","p","abs","Random","nextGaussian","direction","xDirection","yDirection","alive","guassian","update","elapsedTime","removeMe","value","particle","push","length","render","src","onload","particleSystem","makeParticle2","gaussian","creepDied","trailFollow","bombHit","radius","towerSold"],"mappings":"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","sourcesContent":["var Brickout = {\r\n  pages: {},\r\n};\r\n\r\n// ------------------------------------------------------------------\r\n//\r\n// This namespace provides the rendering code for the game.\r\n//\r\n// ------------------------------------------------------------------\r\nBrickout.graphics = (function () {\r\n  \"use strict\";\r\n\r\n  var canvas = document.getElementById(\"canvas-main\"),\r\n    context = canvas.getContext(\"2d\");\r\n\r\n  //\r\n  // Place a 'clear' function on the Canvas prototype, this makes it a part\r\n  // of the canvas, rather than making a function that calls and does it.\r\n  CanvasRenderingContext2D.prototype.clear = function () {\r\n    this.save();\r\n    this.setTransform(1, 0, 0, 1, 0, 0);\r\n    this.clearRect(0, 0, canvas.width, canvas.height);\r\n    this.restore();\r\n  };\r\n\r\n  //------------------------------------------------------------------\r\n  //\r\n  // Public method that allows the client code to clear the canvas.\r\n  //\r\n  //------------------------------------------------------------------\r\n  function clear() {\r\n    context.clear();\r\n  }\r\n\r\n  //------------------------------------------------------------------\r\n  //\r\n  // Draws a rectangle\r\n  //\r\n  //------------------------------------------------------------------\r\n  function drawRectangle(spec) {\r\n    context.fillStyle = spec.fill;\r\n    context.fillRect(spec.x, spec.y, spec.width, spec.height);\r\n\r\n    context.strokeStyle = spec.stroke;\r\n    context.strokeRect(spec.x, spec.y, spec.width, spec.height);\r\n  }\r\n\r\n  //------------------------------------------------------------------\r\n  //\r\n  // Returns the width of the specified text, in pixels.\r\n  //\r\n  //------------------------------------------------------------------\r\n  function measureTextWidth(spec) {\r\n    context.save();\r\n\r\n    context.font = spec.font;\r\n    context.fillStyle = spec.fill;\r\n    if (spec.hasOwnProperty(\"stroke\")) {\r\n      context.strokeStyle = spec.stroke;\r\n    }\r\n    var width = context.measureText(spec.text).width;\r\n\r\n    context.restore();\r\n\r\n    return width;\r\n  }\r\n\r\n  //------------------------------------------------------------------\r\n  //\r\n  // Returns the height of the specified text, in pixels.\r\n  //\r\n  //------------------------------------------------------------------\r\n  function measureTextHeight(spec) {\r\n    var saveText = spec.text;\r\n\r\n    spec.text = \"m\"; // Clever trick to get font height\r\n    context.save();\r\n\r\n    context.font = spec.font;\r\n    context.fillStyle = spec.fill;\r\n    if (spec.hasOwnProperty(\"stroke\")) {\r\n      context.strokeStyle = spec.stroke;\r\n    }\r\n    var width = context.measureText(spec.text).width;\r\n    spec.text = saveText;\r\n\r\n    context.restore();\r\n\r\n    return width;\r\n  }\r\n\r\n  //------------------------------------------------------------------\r\n  //\r\n  // Draw some text to the screen\r\n  //\r\n  //------------------------------------------------------------------\r\n  function drawText(spec) {\r\n    context.save();\r\n\r\n    (context.font = spec.font), (context.fillStyle = spec.fill);\r\n    if (spec.hasOwnProperty(\"stroke\")) {\r\n      context.strokeStyle = spec.stroke;\r\n    }\r\n    context.textBaseline = \"top\";\r\n\r\n    context.fillText(spec.text, spec.position.x, spec.position.y);\r\n    context.strokeText(spec.text, spec.position.x, spec.position.y);\r\n\r\n    context.restore();\r\n  }\r\n\r\n  //------------------------------------------------------------------\r\n  //\r\n  // Expose an ability to draw an image/texture on the canvas.\r\n  //\r\n  //------------------------------------------------------------------\r\n  function drawImage(spec) {\r\n    context.save();\r\n\r\n    context.translate(spec.center.x, spec.center.y);\r\n    context.rotate(spec.rotation);\r\n    context.translate(-spec.center.x, -spec.center.y);\r\n\r\n    context.drawImage(\r\n      spec.image,\r\n      spec.center.x - spec.size / 2,\r\n      spec.center.y - spec.size / 2,\r\n      spec.size,\r\n      spec.size\r\n    );\r\n\r\n    context.restore();\r\n  }\r\n\r\n  return {\r\n    clear: clear,\r\n    drawRectangle: drawRectangle,\r\n    drawText: drawText,\r\n    drawImage: drawImage,\r\n    measureTextWidth: measureTextWidth,\r\n    measureTextHeight: measureTextHeight,\r\n  };\r\n})();\r\n\r\nfunction ParticleSystem(graphics) {\r\n  \"use strict\";\r\n  var that = {},\r\n    image = new Image(),\r\n    particles = {}, // Set of all active particles\r\n    nextName = 1; // Unique identifier for the next particle\r\n\r\n  //------------------------------------------------------------------\r\n  //\r\n  // Create a bunch of particles over the surface of the brick.\r\n  //\r\n  //------------------------------------------------------------------\r\n  that.createEffect = function (spec) {\r\n    var x,\r\n      y,\r\n      deltaX = (spec.right - spec.left) / 10,\r\n      deltaY = (spec.bottom - spec.top) / 10, // bottom - top : remember that Y is position down the screen\r\n      posX,\r\n      posY;\r\n\r\n    spec.speed = {\r\n      mean: 20, // pixels per second\r\n      stdev: 2,\r\n    };\r\n    spec.lifetime = {\r\n      mean: spec.mean,\r\n      stdev: spec.stdev,\r\n    };\r\n\r\n    //\r\n    // Create particles over the area of the brick\r\n    for (x = 0; x < spec.count; x++) {\r\n      posX = Math.trunc(spec.left + x * deltaX);\r\n      for (y = 0; y < spec.count; y++) {\r\n        posY = Math.trunc(spec.top + y * deltaY);\r\n        //\r\n        // Assign a unique name to each particle\r\n        particles[nextName++] = makeParticle(spec, posX, posY);\r\n      }\r\n    }\r\n  };\r\n\r\n  //------------------------------------------------------------------\r\n  //\r\n  // This creates one new particle\r\n  //\r\n  //------------------------------------------------------------------\r\n  function makeParticle(spec, x, y) {\r\n    var p = {\r\n      image: image,\r\n      size: Math.abs(Random.nextGaussian(10, 4)),\r\n      center: { x: x, y: y },\r\n      direction: { x: spec.xDirection, y: spec.yDirection },\r\n      speed: Math.abs(Random.nextGaussian(spec.speed.mean, spec.speed.stdev)), // pixels per second\r\n      rotation: 0,\r\n      lifetime: Math.abs(\r\n        Random.nextGaussian(spec.lifetime.mean, spec.lifetime.stdev)\r\n      ), // How long the particle should live, in milliseconds\r\n      alive: 0, // How long the particle has been alive, in milliseconds\r\n    };\r\n    if (spec.guassian) {\r\n      p.direction = { x: 0, y: Math.abs(Random.nextGaussian(1, 0.25)) };\r\n    }\r\n    return p;\r\n  }\r\n\r\n  //------------------------------------------------------------------\r\n  //\r\n  // Update the state of all particles.  This includes removing any that\r\n  // have exceeded their lifetime.\r\n  //\r\n  //------------------------------------------------------------------\r\n  that.update = function (elapsedTime) {\r\n    var removeMe = [],\r\n      value,\r\n      particle;\r\n    for (value in particles) {\r\n      if (particles.hasOwnProperty(value)) {\r\n        particle = particles[value];\r\n        //\r\n        // Update its position\r\n        particle.center.x +=\r\n          (elapsedTime / 1000) * particle.speed * particle.direction.x;\r\n        particle.center.y +=\r\n          (elapsedTime / 1000) * particle.speed * particle.direction.y;\r\n\r\n        //\r\n        // Rotate proportional to its speed\r\n        particle.rotation += particle.speed / 500;\r\n\r\n        //\r\n        // Update how long it has been alive\r\n        particle.alive += elapsedTime;\r\n\r\n        //\r\n        // If the lifetime has expired, identify it for removal\r\n        if (particle.alive > particle.lifetime) {\r\n          removeMe.push(value);\r\n        }\r\n      }\r\n    }\r\n\r\n    //\r\n    // Remove all of the expired particles\r\n    for (particle = 0; particle < removeMe.length; particle++) {\r\n      delete particles[removeMe[particle]];\r\n    }\r\n  };\r\n\r\n  //------------------------------------------------------------------\r\n  //\r\n  // Initially empty, will be replaced when the texture is loaded\r\n  //\r\n  //------------------------------------------------------------------\r\n  that.render = function () {};\r\n\r\n  image.src = \"assets/fire.png\";\r\n  image.onload = function () {\r\n    that.render = function () {\r\n      var value, particle;\r\n\r\n      for (value in particles) {\r\n        if (particles.hasOwnProperty(value)) {\r\n          particle = particles[value];\r\n          graphics.drawImage(particle);\r\n        }\r\n      }\r\n    };\r\n  };\r\n\r\n  return that;\r\n}\r\n\r\nlet particleSystem = ParticleSystem(Brickout.graphics);\r\n\r\nfunction makeParticle2(\r\n  left,\r\n  right,\r\n  top,\r\n  bottom,\r\n  count,\r\n  xDirection,\r\n  yDirection,\r\n  mean,\r\n  stdev,\r\n  gaussian\r\n) {\r\n  particleSystem.createEffect({\r\n    left: left,\r\n    right: right,\r\n    top: top,\r\n    bottom: bottom,\r\n    count: count,\r\n    xDirection: xDirection,\r\n    yDirection: yDirection,\r\n    mean: mean,\r\n    stdev: stdev,\r\n    gaussian: gaussian,\r\n  });\r\n}\r\n\r\nfunction creepDied(x, y) {\r\n  makeParticle2(x, x + 25, y, y + 25, 10, 0, 0, 800, 200, true);\r\n}\r\n\r\nfunction trailFollow(x, y, xDirection, yDirection) {\r\n  makeParticle2(\r\n    x,\r\n    x + 5,\r\n    y,\r\n    y + 5,\r\n    1,\r\n    xDirection,\r\n    yDirection,\r\n    1000,\r\n    250,\r\n    false\r\n  );\r\n}\r\n\r\nfunction bombHit(x, y, radius) {\r\n  makeParticle2(\r\n    x - radius / 4,\r\n    x + radius / 4,\r\n    y - radius / 4,\r\n    y + radius / 4,\r\n    5,\r\n    0,\r\n    0,\r\n    500,\r\n    100,\r\n    true\r\n  );\r\n}\r\n\r\nfunction towerSold(x, y) {\r\n  makeParticle2(x, x + 50, y, y + 50, 5, 0, 0, 1000, 200, true);\r\n}\r\n"],"file":"particle-system.dev.js"}