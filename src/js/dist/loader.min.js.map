{"version":3,"sources":["loader.js"],"names":["progressSlice","loaderWidth","loader","scriptOrder","scripts","onComplete","message","assetOrder","key","source","dir","location","href","substring","lastIndexOf","entry","loadScripts","length","onSuccess","assets","console","onError","error","loadAssets","loadAsset","fileExtension","xhr","asset","mainComplete","canvas","document","getElementById","context","getContext","GameState","menu","initialize","send","totalItems","Math","floor","timerId","setTimeout","clearInterval","style","width","loaderInitiate","XMLHttpRequest","substr","open","responseType","onload","status","Image","Audio","window","URL","revokeObjectURL","src","log","createObjectURL","response","loaderHide","loaderParent","display","shift"],"mappings":"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","file":"loader.min.js","sourcesContent":["let progressSlice;\r\nlet loaderWidth = 1;\r\n\r\nloader = (function () {\r\n  \"use strict\";\r\n  let scriptOrder = [\r\n    {\r\n      scripts: [\"random\"],\r\n      message: \"Random number generator loaded\",\r\n      onComplete: null,\r\n    },\r\n    {\r\n      scripts: [\"particle-system\"],\r\n      message: \"Random number generator loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"highscore\"],\r\n      message: \"highscore intialized\",\r\n      onComplete: null,\r\n    },\r\n\r\n    // {\r\n    //   scripts: [\"particleSystem\"],\r\n    //   message: \"particle system is intialized\",\r\n    //   onComplete: null,\r\n    // },\r\n\r\n    {\r\n      scripts: [\"utility/enemyCreator\"],\r\n      message: \"enemy creator system is intialized\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"utility/turretCreator\"],\r\n      message: \"tower creation system is intialized\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/about\"],\r\n      message: \"about is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"bullet\"],\r\n      message: \"bullet is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"bulletcontroller\"],\r\n      message: \"bulletcontroller is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"level\"],\r\n      message: \"level is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/game-play\"],\r\n      message: \" game-play is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/help\"],\r\n      message: \"help is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/highscores\"],\r\n      message: \"highscore is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/control\"],\r\n      message: \"control is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/mainmenu\"],\r\n      message: \"mainmenu is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/menumanager\"],\r\n      message: \"menumanager is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"utility/text\"],\r\n      message: \"enemy is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"tower\"],\r\n      message: \"enemy is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"sprite\"],\r\n      message: \"enemy is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"enemy\"],\r\n      message: \"enemy is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"enemyController\"],\r\n      message: \"enemyController is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"input/input\"],\r\n      message: \"input is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"input/mouse\"],\r\n      message: \"Mouse inputHandler is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"gamemodel\"],\r\n      message: \"modelAnimation is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"movingevents\"],\r\n      message: \"moving object is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"sound\"],\r\n      message: \"sound intialized\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"utility/initialize\"],\r\n      message: \"game menu intialized\",\r\n      onComplete: null,\r\n    },\r\n  ];\r\n  var href = window.location.href;\r\n  var dir = href.substring(0, href.lastIndexOf(\"/\")) + \"/\";\r\n\r\n  let assetOrder = [\r\n    {\r\n      key: \"fire\",\r\n      source: dir + \"assets/fire.png\",\r\n    },\r\n    {\r\n      key: \"smoke\",\r\n      source: dir + \"assets/smoke.png\",\r\n    },\r\n\r\n    {\r\n      key: \"tower1\",\r\n      source: dir + \"assets/turret/turret-1-1.png\",\r\n    },\r\n\r\n    {\r\n      key: \"tower2\",\r\n      source: dir + \"assets/turret/turret-6-1.png\",\r\n    },\r\n\r\n    {\r\n      key: \"tower3\",\r\n      source: dir + \"assets/turret/turret-4-1.png\",\r\n    },\r\n\r\n    {\r\n      key: \"tower4\",\r\n      source: dir + \"assets/turret/turret-5-1.png\",\r\n    },\r\n\r\n    {\r\n      key: \"base\",\r\n      source: dir + \"assets/turret/turret-base.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep10\",\r\n      source: dir + \"assets/creeps1/1.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep11\",\r\n      source: dir + \"assets/creeps1/2.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep12\",\r\n      source: dir + \"assets/creeps1/3.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep13\",\r\n      source: dir + \"assets/creeps1/4.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep14\",\r\n      source: dir + \"assets/creeps1/5.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep15\",\r\n      source: dir + \"assets/creeps1/6.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep20\",\r\n      source: dir + \"assets/creeps2/1.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep21\",\r\n      source: dir + \"assets/creeps2/2.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep22\",\r\n      source: dir + \"assets/creeps2/3.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep23\",\r\n      source: dir + \"assets/creeps2/4.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep30\",\r\n      source: dir + \"assets/creeps3/1.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep31\",\r\n      source: dir + \"assets/creeps3/2.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep32\",\r\n      source: dir + \"assets/creeps3/3.png\",\r\n    },\r\n\r\n    {\r\n      key: \"creep33\",\r\n      source: dir + \"assets/creeps3/4.png\",\r\n    },\r\n    // {\r\n    //   key: \"end audio\",\r\n    //   source: dir + \"assets/sounds/success_end.mp3\",\r\n    // },\r\n  ];\r\n\r\n  console.log(assetOrder.length);\r\n\r\n  function loadScripts(scripts, onComplete) {\r\n    if (scripts.length > 0) {\r\n      let entry = scripts[0];\r\n      require(entry.scripts, function () {\r\n        if (entry.onComplete) {\r\n          entry.onComplete();\r\n        }\r\n        scripts.shift(); // Alternatively: scripts.splice(0, 1);\r\n        loaderWidth += progressSlice;\r\n        loadScripts(scripts, onComplete);\r\n      });\r\n    } else {\r\n      onComplete();\r\n    }\r\n  }\r\n\r\n  function loadAssets(assets, onSuccess, onError, onComplete) {\r\n    //\r\n    // When we run out of things to load, that is when we call onComplete.\r\n    if (assets.length > 0) {\r\n      let entry = assets[0];\r\n      loadAsset(\r\n        entry.source,\r\n        function (asset) {\r\n          onSuccess(entry, asset);\r\n          assets.shift(); // Alternatively: assets.splice(0, 1);\r\n          loaderWidth += progressSlice;\r\n          loadAssets(assets, onSuccess, onError, onComplete);\r\n        },\r\n        function (error) {\r\n          console.log(error.message);\r\n          onError(error);\r\n          assets.shift(); // Alternatively: assets.splice(0, 1);\r\n          loadAssets(assets, onSuccess, onError, onComplete);\r\n        }\r\n      );\r\n    } else {\r\n      onComplete();\r\n    }\r\n  }\r\n\r\n  function loadAsset(source, onSuccess, onError) {\r\n    let xhr = new XMLHttpRequest();\r\n    let fileExtension = source.substr(source.lastIndexOf(\".\") + 1); // Source: http://stackoverflow.com/questions/680929/how-to-extract-extension-from-filename-string-in-javascript\r\n\r\n    if (fileExtension) {\r\n      xhr.open(\"GET\", source, true);\r\n      xhr.responseType = \"blob\";\r\n\r\n      xhr.onload = function () {\r\n        let asset = null;\r\n        if (xhr.status === 200) {\r\n          if (fileExtension === \"png\" || fileExtension === \"jpg\") {\r\n            asset = new Image();\r\n          } else if (fileExtension === \"mp3\") {\r\n            asset = new Audio();\r\n          } else {\r\n            if (onError) {\r\n              onError(\"Unknown file extension: \" + fileExtension);\r\n            }\r\n          }\r\n          asset.onload = function () {\r\n            // if (fileExtension === \"mp3\") {\r\n            //   console.log(asset.src);\r\n            // }\r\n            window.URL.revokeObjectURL(asset.src);\r\n            if (onSuccess) {\r\n              onSuccess(asset);\r\n            } else {\r\n              console.log(\"hello error\");\r\n            }\r\n          };\r\n          asset.src = window.URL.createObjectURL(xhr.response);\r\n          // console.log(xhr.response);\r\n        } else {\r\n          if (onError) {\r\n            onError(\"Failed to retrieve: \" + source);\r\n          }\r\n        }\r\n      };\r\n    } else {\r\n      if (onError) {\r\n        onError(\"Unknown file extension: \" + fileExtension);\r\n      }\r\n    }\r\n\r\n    xhr.send();\r\n  }\r\n\r\n  function mainComplete() {\r\n    canvas = document.getElementById(\"canvas-main\");\r\n    context = canvas.getContext(\"2d\");\r\n    // const game1 = new Game();\r\n    GameState.menu.initialize();\r\n  }\r\n\r\n  function loaderInitiate() {\r\n    let totalItems = assetOrder.length + scriptOrder.length;\r\n    progressSlice = Math.floor(100 / totalItems);\r\n    let loader = document.getElementById(\"loader\");\r\n    let timerId = setTimeout(loop, 1000);\r\n\r\n    function loop() {\r\n      if (loaderWidth >= 100) {\r\n        clearInterval(timerId);\r\n      } else {\r\n        loader.style.width = loaderWidth + \"%\";\r\n      }\r\n      // console.log(loaderWidth);\r\n    }\r\n  }\r\n\r\n  function loaderHide() {\r\n    let loaderParent = document.getElementById(\"loader_wrapper\");\r\n    loaderParent.style.display = \"none\";\r\n  }\r\n\r\n  loaderInitiate();\r\n  loadAssets(\r\n    assetOrder,\r\n    function (source, asset) {\r\n      // Store it on success\r\n      GameState.assets[source.key] = asset;\r\n    },\r\n    function (error) {\r\n      console.log(error);\r\n    },\r\n    function () {\r\n      loadScripts(scriptOrder, mainComplete);\r\n    }\r\n  );\r\n  loaderHide();\r\n})();\r\n"]}