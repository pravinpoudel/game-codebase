{"version":3,"sources":["loader.js"],"names":["progressSlice","loaderWidth","loader","scriptOrder","scripts","message","onComplete","key","source","loadScripts","console","entry","shift","mainComplete","loaderHide","loaderParent","Game","style","loaderInitiate","loadAssets","assetOrder","length","Math","floor","totalItems","GameState","assets","timerId","error","clearInterval","width","log","fileExtension","onSuccess","lastIndexOf","xhr","responseType","onError","XMLHttpRequest","substr","asset","open","onload","status","Image","Audio","URL","revokeObjectURL","src","menu","initialize","createObjectURL","response","document","loadAsset","getElementById","display"],"mappings":"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","file":"loader.min.js","sourcesContent":["let progressSlice;\r\nlet loaderWidth = 1;\r\n\r\nloader = (function () {\r\n  \"use strict\";\r\n  let scriptOrder = [\r\n    {\r\n      scripts: [\"random\"],\r\n      message: \"Random number generator loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"utility/index\"],\r\n      message: \"utility is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/about\"],\r\n      message: \"about is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/game-play\"],\r\n      message: \" game-play is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/help\"],\r\n      message: \"help is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/highscores\"],\r\n      message: \"highscore is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/mainmenu\"],\r\n      message: \"mainmenu is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"screens/menumanager\"],\r\n      message: \"menumanager is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"input/input\"],\r\n      message: \"input is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"modelAnimation\"],\r\n      message: \"modelAnimation is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"player\"],\r\n      message: \"moving object is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"input/input\"],\r\n      message: \"input is loaded\",\r\n      onComplete: null,\r\n    },\r\n\r\n    {\r\n      scripts: [\"utility/initialize\"],\r\n      message: \"game menu intialized\",\r\n      onComplete: null,\r\n    },\r\n    {\r\n      scripts: [\"game\"],\r\n      message: \"game class is loaded\",\r\n      onComplete: null,\r\n    },\r\n  ];\r\n\r\n  let assetOrder = [\r\n    {\r\n      key: \"fire\",\r\n      source: \"/assets/fire.png\",\r\n    },\r\n    {\r\n      key: \"smoke\",\r\n      source: \"/assets/smoke.png\",\r\n    },\r\n  ];\r\n\r\n  function loadScripts(scripts, onComplete) {\r\n    if (scripts.length > 0) {\r\n      let entry = scripts[0];\r\n      require(entry.scripts, function () {\r\n        console.log(entry.message);\r\n        if (entry.onComplete) {\r\n          entry.onComplete();\r\n        }\r\n        scripts.shift(); // Alternatively: scripts.splice(0, 1);\r\n        loaderWidth += progressSlice;\r\n        loadScripts(scripts, onComplete);\r\n      });\r\n    } else {\r\n      onComplete();\r\n    }\r\n  }\r\n\r\n  function loadAssets(assets, onSuccess, onError, onComplete) {\r\n    //\r\n    // When we run out of things to load, that is when we call onComplete.\r\n    if (assets.length > 0) {\r\n      let entry = assets[0];\r\n      loadAsset(\r\n        entry.source,\r\n        function (asset) {\r\n          onSuccess(entry, asset);\r\n          assets.shift(); // Alternatively: assets.splice(0, 1);\r\n          loaderWidth += progressSlice;\r\n          loadAssets(assets, onSuccess, onError, onComplete);\r\n        },\r\n        function (error) {\r\n          onError(error);\r\n          assets.shift(); // Alternatively: assets.splice(0, 1);\r\n          loadAssets(assets, onSuccess, onError, onComplete);\r\n        }\r\n      );\r\n    } else {\r\n      onComplete();\r\n    }\r\n  }\r\n\r\n  function loadAsset(source, onSuccess, onError) {\r\n    let xhr = new XMLHttpRequest();\r\n    let fileExtension = source.substr(source.lastIndexOf(\".\") + 1); // Source: http://stackoverflow.com/questions/680929/how-to-extract-extension-from-filename-string-in-javascript\r\n\r\n    if (fileExtension) {\r\n      xhr.open(\"GET\", source, true);\r\n      xhr.responseType = \"blob\";\r\n\r\n      xhr.onload = function () {\r\n        let asset = null;\r\n        if (xhr.status === 200) {\r\n          if (fileExtension === \"png\" || fileExtension === \"jpg\") {\r\n            asset = new Image();\r\n          } else if (fileExtension === \"mp3\") {\r\n            asset = new Audio();\r\n          } else {\r\n            if (onError) {\r\n              onError(\"Unknown file extension: \" + fileExtension);\r\n            }\r\n          }\r\n          asset.onload = function () {\r\n            window.URL.revokeObjectURL(asset.src);\r\n            if (onSuccess) {\r\n              onSuccess(asset);\r\n            }\r\n          };\r\n          asset.src = window.URL.createObjectURL(xhr.response);\r\n        } else {\r\n          if (onError) {\r\n            onError(\"Failed to retrieve: \" + source);\r\n          }\r\n        }\r\n      };\r\n    } else {\r\n      if (onError) {\r\n        onError(\"Unknown file extension: \" + fileExtension);\r\n      }\r\n    }\r\n\r\n    xhr.send();\r\n  }\r\n\r\n  function mainComplete() {\r\n    console.log(\"It is all loaded up\");\r\n    const game1 = new Game();\r\n    GameState.menu.initialize();\r\n  }\r\n\r\n  function loaderInitiate() {\r\n    let totalItems = assetOrder.length + scriptOrder.length;\r\n    progressSlice = Math.floor(100 / totalItems);\r\n    let loader = document.getElementById(\"loader\");\r\n    let timerId = setTimeout(loop, 1000);\r\n\r\n    function loop() {\r\n      if (loaderWidth >= 100) {\r\n        clearInterval(timerId);\r\n      } else {\r\n        loader.style.width = loaderWidth + \"%\";\r\n      }\r\n      console.log(loaderWidth);\r\n    }\r\n  }\r\n\r\n  function loaderHide() {\r\n    let loaderParent = document.getElementById(\"loader_wrapper\");\r\n    loaderParent.style.display = \"none\";\r\n  }\r\n\r\n  loaderInitiate();\r\n  loadAssets(\r\n    assetOrder,\r\n    function (source, asset) {\r\n      // Store it on success\r\n      GameState.assets[source.key] = asset;\r\n    },\r\n    function (error) {\r\n      console.log(error);\r\n    },\r\n    function () {\r\n      loadScripts(scriptOrder, mainComplete);\r\n    }\r\n  );\r\n  loaderHide();\r\n})();\r\n"]}