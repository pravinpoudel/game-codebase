"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var GamePlay=function(){function r(e,t){_classCallCheck(this,r),this.myKeyboard=t,this.myMouse=null,this.lastTimeStamp,this.manager=e,this.model=null,this.initialize=this.initialize.bind(this),this.run=this.run.bind(this),this.playerModel=null,self.wallModel=null,this.renderCircle=!1,this.sound=null,this.particlesSmoke=null,this.creeps=[makeCreateCreep1(20,300),makeCreateCreep2(100,300),makeCreateCreep3(300,300)],this.towers=[],this.registerKey=this.registerKey.bind(this),this.flyingScores=[],this.tower1=new Image,this.tower1.src="assets/turret/turret-5-3.png",this.render=this.render.bind(this),this.firstTime=!0,this.downHandler=this.downHandler.bind(this)}return _createClass(r,[{key:"downHandler",value:function(e){mouse.isActive=!0,firstTime?(console.log("firsttime"),firstTime=!1,renderCircle=!0,mouse.isActive=!0):(firstTime=!0,mouse.isActive=!1,renderCircle=!1,this.towers.push(createTower("assets/turret/turret-5-3.png",mouse.x,mouse.y,1e3,1)),console.log(this.towers.length));canvas.getBoundingClientRect();mouse.x=e.x,mouse.y=e.y}},{key:"initialize",value:function(){var e=this;this.myMouse=new Mouse,e.myKeyboard.register("Escape",function(){GameState.cancelNextRequest=!0,e.manager.showScreen("mainmenu")}),this.bulletController=new BulletController,this.towers.push(createTower("assets/turret/turret-5-3.png",300,500,1e3,1)),this.towers.push(createTower("assets/turret/turret-3-3.png",600,500,2e3,2)),this.myMouse.register("mousedown",this.downHandler),this.myMouse.register("mousemove",function(e,t){if(mouse.isActive){var r=canvas.getBoundingClientRect();mouse.x=e.clientX-r.left,mouse.y=e.clientY,this.renderCircle=!0}})}},{key:"processInput",value:function(e){this.myKeyboard.update(e),this.myMouse.update(e)}},{key:"registerKey",value:function(){localStorage.upgrade,localStorage.sell,localStorage.start;this.myKeyboard.cleanAll()}},{key:"update",value:function(e){if(GameState.life<=0)return GameState.cancelNextRequest=!0,void this.particlesSmoke.update(e);for(var t=this.creeps.length,r=0;r<t;r++){var s=this.creeps[r];if(s){if(0==s.health){var i=s.player.specs.center.x,n=s.player.specs.center.y;this.creeps.splice(r,1);var o=new MovingEvents({size:{x:50,y:50},center:{x:i,y:n},rotation:0,moveRate:.125,rotateRate:Math.PI/1e3,continousSpeed:50,yDirection:-1,xDirection:0});this.flyingScores.push(new FlyingScore("10",o,!0));continue}s.update(e);for(var a=this.towers.length,l=0;l<a;l++){var c=this.towers[l];if(isColliding(s,c,200)&&(c.setTarget(s.player.specs.center.x,s.player.specs.center.y),c.canShoot)){var u={x:c.specs.target.x-c.specs.center.x,y:c.specs.target.y-c.specs.center.y};u=normalize(u);var h=c.specs.center.x,d=c.specs.center.y;this.bulletController.addBullet(h,d,s,c.specs.power)}c.update(e)}}}this.bulletController.update(e);for(var p=this.flyingScores.length,m=0;m<p;m++)this.flyingScores[m].update(e),this.flyingScores[m].isVisible||(this.flyingScores.splice(m,1),m--,p--)}},{key:"renderScore",value:function(){document.getElementById("currentScore").innerHTML=score,document.getElementById("lives").innerHTML=GameState.life}},{key:"render",value:function(){context.clearRect(0,0,canvas.width,canvas.height),renderCircle&&drawTower(this.tower1,200),this.renderScore(),this.creeps.forEach(function(e){e.render()});for(var e=this.towers.length,t=0;t<e;t++){this.towers[t].render()}this.bulletController.render();for(var r=this.flyingScores.length,s=0;s<r;s++)this.flyingScores[s].render()}},{key:"run",value:function(){var r=this;this.sound=new Sound,this.sound.loadAudio(),this.registerKey();var s=performance.now();GameState.cancelNextRequest=!1,requestAnimationFrame(function e(t){r.processInput(t-s),r.update(t-s),s=t,r.render(),GameState.cancelNextRequest||requestAnimationFrame(e)})}}]),r}();
//# sourceMappingURL=game-play.min.js.map
