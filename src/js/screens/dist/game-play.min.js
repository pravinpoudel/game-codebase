"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var GamePlay=function(){function r(e,t){_classCallCheck(this,r),this.myKeyboard=t,this.lastTimeStamp,this.manager=e,this.model=null,this.initialize=this.initialize.bind(this),this.run=this.run.bind(this),this.playerModel=null,self.wallModel=null,this.sound=null,this.particlesSmoke=null,this.tower=null,this.creeps=[makeCreateCreep1(20,300),makeCreateCreep2(100,300),makeCreateCreep3(300,300)],this.registerKey=this.registerKey.bind(this)}return _createClass(r,[{key:"initialize",value:function(){var e=this;e.myKeyboard.register("Escape",function(){GameState.cancelNextRequest=!0,e.manager.showScreen("mainmenu")}),this.bulletController=new BulletController,this.tower=new Tower({baseSprite:"assets/tile-1-center.gif",weaponSprite:"assets/turret/turret-5-3.png",center:{x:300,y:400},target:{x:300,y:100},rotateRate:6*3.14159/1e3,delay:2e3,power:2})}},{key:"processInput",value:function(e){this.myKeyboard.update(e)}},{key:"registerKey",value:function(){localStorage.upgrade,localStorage.sell,localStorage.start;this.myKeyboard.cleanAll()}},{key:"update",value:function(e){if(GameState.life<=0)return GameState.cancelNextRequest=!0,void this.particlesSmoke.update(e);for(var t=this.creeps.length,r=0;r<t;r++){var i=this.creeps[r];if(i){if(0==i.health){this.creeps.splice(r,1);continue}if(i.update(e),isColliding(i,this.tower,200)&&(this.tower.setTarget(i.player.specs.center.x,i.player.specs.center.y),this.tower.canShoot)){var n={x:this.tower.specs.target.x-this.tower.specs.center.x,y:this.tower.specs.target.y-this.tower.specs.center.y};n=normalize(n);var s=this.tower.specs.center.x,a=this.tower.specs.center.y;this.bulletController.addBullet(s,a,i,this.tower.specs.power)}}}this.tower.update(e),this.bulletController.update(e)}},{key:"renderScore",value:function(){document.getElementById("currentScore").innerHTML=score,document.getElementById("lives").innerHTML=GameState.life}},{key:"render",value:function(){context.clearRect(0,0,canvas.width,canvas.height),this.renderScore(),this.creeps.forEach(function(e){e.render()}),this.tower.render(),this.bulletController.render()}},{key:"run",value:function(){var r=this;this.sound=new Sound,this.sound.loadAudio(),this.registerKey();var i=performance.now();GameState.cancelNextRequest=!1,requestAnimationFrame(function e(t){r.processInput(t-i),r.update(t-i),i=t,r.render(),GameState.cancelNextRequest||requestAnimationFrame(e)})}}]),r}();
//# sourceMappingURL=game-play.min.js.map
