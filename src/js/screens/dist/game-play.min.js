"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}var GamePlay=function(){function s(e,t){_classCallCheck(this,s),this.myKeyboard=t,this.myMouse=null,this.lastTimeStamp,this.manager=e,this.model=null,this.initialize=this.initialize.bind(this),this.run=this.run.bind(this),this.playerModel=null,self.wallModel=null,this.renderCircle=!1,this.sound=null,this.particlesSmoke=null,this.creeps=[],this.towers=[],this.registerKey=this.registerKey.bind(this),this.flyingScores=[],this.tower1=new Image,this.tower1.src="assets/turret/turret-5-3.png",this.render=this.render.bind(this),this.firstTime=!0,this.downHandler=this.downHandler.bind(this),this.enemyCreator=new EnemyCreator(10),this.canPlace=!1}return _createClass(s,[{key:"createElement",value:function(){var e=this.getAttribute("data-myName");selectedTower="assets/turret/"+e,console.log(selectedTower),renderCircle=!0,mouse.isActive=!0}},{key:"downHandler",value:function(e){if(mouse.isActive){firstTime=!0,mouse.isActive=!1,renderCircle=!1,console.log(selectedTower),canCreated(this.towers)&&this.canPlace&&this.towers.push(createTower(selectedTower,Math.floor(mouse.x/cellWidth)*cellWidth,Math.floor((mouse.y-200)/cellWidth)*cellWidth+200,1e3,1));canvas.getBoundingClientRect()}else{var t=canvas.getBoundingClientRect();mouse.x=e.clientX-t.left,mouse.y=e.clientY-t.top,findSelectedTower(this.towers)}}},{key:"muteVolume",value:function(){for(var e=document.getElementsByClassName("volumeButton"),t=0;t<e.length;t++)e[t].style.display="block";var s=this.getAttribute("data-myId");document.getElementById(s).style.display="none"}},{key:"initialize",value:function(){var e=this;this.myMouse=new Mouse,e.myKeyboard.register("Escape",function(){GameState.cancelNextRequest=!0,e.manager.showScreen("mainmenu")});for(var t=0;t<rows;t++){for(var s=[],r=0;r<cols;r++)s.push({x:t,y:r});cellSet.push(s)}for(var n=document.getElementsByClassName("tower"),i=0;i<n.length;i++)n[i].addEventListener("click",this.createElement,!1);var l=document.getElementsByClassName("volumeButton");for(i=0;i<l.length;i++)l[i].addEventListener("click",this.muteVolume,!1);this.bulletController=new BulletController,this.myMouse.register("mousedown",this.downHandler),this.myMouse.register("mousemove",function(e,t){if(mouse.isActive){var s=canvas.getBoundingClientRect();mouse.x=e.clientX-s.left,mouse.y=e.clientY-s.top,mouse.y<200&&(mouse.y=200),this.renderCircle=!0}})}},{key:"processInput",value:function(e){this.myKeyboard.update(e),this.myMouse.update(e)}},{key:"registerKey",value:function(){localStorage.upgrade,localStorage.sell,localStorage.start;this.myKeyboard.cleanAll()}},{key:"update",value:function(e){if(GameState.life<=0)GameState.cancelNextRequest=!0;else{for(var t=this.creeps.length,s=0;s<t;s++){var r=this.creeps[s];if(r){if(r.reachRight()){this.creeps.splice(s,1),GameState.life--,console.log(GameState.life);continue}if(0==r.health){var n=r.player.specs.center.x,i=r.player.specs.center.y;score+=r.maxHealth,this.creeps.splice(s,1);var l=new MovingEvents({size:{x:50,y:50},center:{x:n,y:i},rotation:0,moveRate:.125,rotateRate:Math.PI/1e3,continousSpeed:50,yDirection:-1,xDirection:0});this.flyingScores.push(new FlyingScore(r.maxHealth,l,!0));continue}r.update(e);for(var o=this.towers.length,a=0;a<o;a++){var c=this.towers[a];if(isColliding(r,c,100)&&(c.setTarget(r.player.specs.center.x,r.player.specs.center.y),c.canShoot)){var u={x:c.specs.target.x-c.specs.center.x,y:c.specs.target.y-c.specs.center.y};u=normalize(u);var h=c.specs.center.x,d=c.specs.center.y;this.bulletController.addBullet(h,d,r,c.specs.power)}c.update(e)}}}this.bulletController.update(e);for(var m=this.flyingScores.length,f=0;f<m;f++)this.flyingScores[f].update(e),this.flyingScores[f].isVisible||(this.flyingScores.splice(f,1),f--,m--);var y=this.enemyCreator.createEnemy(e);y&&this.creeps.push(y)}}},{key:"renderScore",value:function(){document.getElementById("currentScore").innerHTML=score,document.getElementById("lives").innerHTML=GameState.life,document.getElementById("money").innerHTML=money;var e=wavesDeno+"/"+wavesNeno;document.getElementById("wave").innerHTML=e}},{key:"render",value:function(){if(context.clearRect(0,0,canvas.width,canvas.height),context.fillStyle="green",context.fillRect(0,200,600,800),context.clearRect(50,250,500,500),context.clearRect(0,400,50,200),context.clearRect(550,400,50,200),mouse.isActive){for(var e=!1,t=0;t<rows;t++)for(var s=0;s<cols;s++){var r=cellSet[t][s].x,n=cellSet[t][s].y;Math.floor((mouse.x-leftOffset)/cellWidth)==r&&Math.floor((mouse.y-topOffset)/cellWidth)==n&&(e=this.canPlace=!0,context.beginPath(),context.rect(r*cellWidth+leftOffset,n*cellWidth+topOffset,cellWidth,cellWidth),context.stroke())}e||(this.canPlace=!1)}context.beginPath(),context.moveTo(0,200),context.lineTo(canvas.width,200),context.stroke(),renderCircle&&drawTower(100),this.renderScore(),this.creeps.forEach(function(e){e.render()});for(var i=this.towers.length,l=0;l<i;l++){this.towers[l].render()}this.bulletController.render();for(var o=this.flyingScores.length,a=0;a<o;a++)this.flyingScores[a].render()}},{key:"run",value:function(){var s=this;this.sound=new Sound,this.sound.loadAudio(),this.registerKey();var r=performance.now();GameState.cancelNextRequest=!1,requestAnimationFrame(function e(t){s.processInput(t-r),s.update(t-r),r=t,s.render(),GameState.cancelNextRequest||requestAnimationFrame(e)})}}]),s}();
//# sourceMappingURL=game-play.min.js.map
