{"version":3,"sources":["game-play.js"],"names":["GamePlay","manager","input","myKeyboard","lastTimeStamp","model","initialize","bind","run","playerModel","self","wallModel","sound","particlesSmoke","tower","creeps","makeCreateCreep1","makeCreateCreep2","makeCreateCreep3","registerKey","register","GameState","cancelNextRequest","showScreen","bulletController","BulletController","Tower","baseSprite","weaponSprite","center","x","y","target","rotateRate","delay","power","elapsedTime","update","upgrade","localStorage","sell","start","cleanAll","life","creepsLength","length","i","creep","health","splice","isColliding","setTarget","player","specs","canShoot","direction","normalize","bulletStartX","bulletStartY","addBullet","document","getElementById","innerHTML","score","context","clearRect","canvas","width","height","renderScore","forEach","render","Sound","loadAudio","performance","now","gameLoop","time","processInput","requestAnimationFrame"],"mappings":"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","sourcesContent":["class GamePlay {\r\n  constructor(manager, input) {\r\n    this.myKeyboard = input;\r\n    this.lastTimeStamp;\r\n    this.manager = manager;\r\n    this.model = null;\r\n    this.initialize = this.initialize.bind(this);\r\n    this.run = this.run.bind(this);\r\n    this.playerModel = null;\r\n    self.wallModel = null;\r\n    this.sound = null;\r\n    this.particlesSmoke = null;\r\n    this.tower = null;\r\n    this.creeps = [\r\n      makeCreateCreep1(20, 300),\r\n      makeCreateCreep2(100, 300),\r\n      makeCreateCreep3(300, 300),\r\n    ];\r\n    this.registerKey = this.registerKey.bind(this);\r\n  }\r\n\r\n  initialize() {\r\n    let self = this;\r\n    self.myKeyboard.register(\"Escape\", function () {\r\n      GameState.cancelNextRequest = true;\r\n      self.manager.showScreen(\"mainmenu\");\r\n    });\r\n\r\n    this.bulletController = new BulletController();\r\n    this.tower = new Tower({\r\n      baseSprite: \"assets/tile-1-center.gif\",\r\n      weaponSprite: \"assets/turret/turret-5-3.png\",\r\n      center: { x: 300, y: 400 },\r\n      target: { x: 300, y: 100 },\r\n      rotateRate: (6 * 3.14159) / 1000, // radians per second\r\n      delay: 2000,\r\n      power:2\r\n    });\r\n  }\r\n\r\n  processInput(elapsedTime) {\r\n    this.myKeyboard.update(elapsedTime);\r\n  }\r\n\r\n  registerKey() {\r\n    let self = this;\r\n    let upgrade = localStorage[\"upgrade\"];\r\n    let sell = localStorage[\"sell\"];\r\n    let start = localStorage[\"start\"];\r\n    self.myKeyboard.cleanAll();\r\n  }\r\n\r\n  update(elapsedTime) {\r\n    if (GameState.life <= 0) {\r\n      GameState.cancelNextRequest = true;\r\n      this.particlesSmoke.update(elapsedTime);\r\n      return;\r\n    }\r\n    let creepsLength =  this.creeps.length;\r\n    for (let i = 0; i < creepsLength; i++) {\r\n      let creep = this.creeps[i];\r\n      if(creep){\r\n        if(creep.health == 0){\r\n          this.creeps.splice(i,1);\r\n          continue;\r\n        }\r\n        creep.update(elapsedTime);\r\n        if (isColliding(creep, this.tower, 200)) {\r\n          this.tower.setTarget(\r\n            creep.player.specs.center.x,\r\n            creep.player.specs.center.y\r\n          );\r\n          if (this.tower.canShoot) {\r\n            let direction = {\r\n              x: this.tower.specs.target.x - this.tower.specs.center.x,\r\n              y: this.tower.specs.target.y - this.tower.specs.center.y,\r\n            };\r\n            direction = normalize(direction);\r\n            let bulletStartX = this.tower.specs.center.x;\r\n            let bulletStartY = this.tower.specs.center.y;\r\n  \r\n            this.bulletController.addBullet(\r\n              bulletStartX,\r\n              bulletStartY,\r\n              creep,\r\n              this.tower.specs.power\r\n            );\r\n          }\r\n        }\r\n  \r\n      }\r\n    }\r\n    this.tower.update(elapsedTime);\r\n    this.bulletController.update(elapsedTime);\r\n    // model.update(elapsedTime);\r\n  }\r\n\r\n  renderScore() {\r\n    document.getElementById(\"currentScore\").innerHTML = score;\r\n    document.getElementById(\"lives\").innerHTML = GameState.life;\r\n  }\r\n\r\n  render() {\r\n    context.clearRect(0, 0, canvas.width, canvas.height);\r\n    this.renderScore();\r\n    this.creeps.forEach((creep) => {\r\n      creep.render();\r\n    });\r\n    this.tower.render();\r\n    this.bulletController.render();\r\n  }\r\n\r\n  run() {\r\n    let self = this;\r\n    this.sound = new Sound();\r\n\r\n    this.sound.loadAudio();\r\n    this.registerKey();\r\n\r\n    // this.myKeyboard.register(\"ArrowUp\", self.playerModel.player.moveTop);\r\n    // this.myKeyboard.register(\"ArrowDown\", self.playerModel.player.moveDown);\r\n    // this.myKeyboard.register(\"ArrowLeft\", self.playerModel.player.moveLeft);\r\n    // this.myKeyboard.register(\"ArrowRight\", self.playerModel.player.moveRight);\r\n    // console.log(self.playerModel.moveRight);\r\n\r\n    let lastTimeStamp = performance.now();\r\n    GameState.cancelNextRequest = false;\r\n\r\n    function gameLoop(time) {\r\n      self.processInput(time - lastTimeStamp);\r\n      self.update(time - lastTimeStamp);\r\n      lastTimeStamp = time;\r\n      self.render();\r\n      if (!GameState.cancelNextRequest) {\r\n        requestAnimationFrame(gameLoop);\r\n      }\r\n    }\r\n    requestAnimationFrame(gameLoop);\r\n  }\r\n}\r\n"],"file":"game-play.dev.js"}